# environment.yml — OpenFold3 + DeepSpeed reproducible environment
# Target: Linux x86_64 · Python 3.12 · CUDA 12.6
# FIXED: Relaxed strict patch pins to allow solver resolution

name: of3ds

channels:
  - pytorch
  - nvidia
  - conda-forge
  - defaults

dependencies:
  # ── Python runtime ──────────────────────────────────────────────
  - python=3.12
  - pip=24.3

  # ── CUDA toolkit (Relaxed pins for solver sanity) ───────────────
  - cuda-toolkit=12.6.*
  - cuda-cudart=12.6.*
  - cuda-nvcc=12.6.*
  - cuda-libraries=12.6.*
  - cuda-libraries-dev=12.6.*
  - cuda-nvrtc=12.6.*
  - cuda-cccl=12.6.*
  - libcublas=12.6.*
  - libcusolver=11.*
  - libcusparse=12.*
  - libcufft=11.*
  - libcurand=10.*

  # ── Compiler toolchain ─────────────────────────────────────────
  - gxx_linux-64=13.*
  - gcc_linux-64=13.*
  - cmake>=3.31       # Fixed: allow any 3.31+ version
  - ninja=1.12.*
  - make=4.4.*

  # ── Core scientific stack ──────────────────────────────────────
  - numpy=1.26.*
  - scipy=1.14.*
  - mkl=2024.2.*

  # ── System libraries ───────────────────────────────────────────
  - openssl=3.4.*
  - ca-certificates
  - libffi=3.4.*
  - zlib=1.3.*

  # ── Pip-managed packages ───────────────────────────────────────
  - pip:
    - -r requirements-lock.txt
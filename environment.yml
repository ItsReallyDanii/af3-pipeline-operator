# environment.yml — OpenFold3 + DeepSpeed reproducible environment
# Target: Linux x86_64 · Python 3.12 · CUDA 12.8 driver · single GPU
# PyTorch CUDA 12.6 toolkit builds are forward-compatible with CUDA 12.8 drivers.
#
# Usage:
#   conda env create -f environment.yml
#   conda activate of3ds
#
# Rebuild from scratch:
#   conda env remove -n of3ds && conda env create -f environment.yml

name: of3ds

channels:
  - pytorch
  - nvidia
  - conda-forge
  - defaults

dependencies:
  # ── Python runtime ──────────────────────────────────────────────
  - python=3.12.8
  - pip=24.3.1

  # ── CUDA toolkit (conda-managed, matches PyTorch cu126 build) ──
  - cuda-toolkit=12.6.3
  - cuda-cudart=12.6.77
  - cuda-nvcc=12.6.85
  - cuda-libraries=12.6.3
  - cuda-libraries-dev=12.6.3
  - cuda-nvrtc=12.6.77
  - cuda-cccl=12.6.77
  - libcublas=12.6.4.1
  - libcublas-dev=12.6.4.1
  - libcusolver=11.7.1.2
  - libcusolver-dev=11.7.1.2
  - libcusparse=12.5.4.2
  - libcusparse-dev=12.5.4.2
  - libcufft=11.3.0.4
  - libcurand=10.3.7.77

  # ── Compiler toolchain ─────────────────────────────────────────
  - gxx_linux-64=13.3.0
  - gcc_linux-64=13.3.0
  - cmake=3.31.3
  - ninja=1.12.1
  - make=4.4.1

  # ── Core scientific stack (conda-managed for MKL/BLAS) ─────────
  - numpy=1.26.4
  - scipy=1.14.1
  - mkl=2024.2.2

  # ── System libraries ───────────────────────────────────────────
  - openssl=3.4.0
  - ca-certificates=2024.12.14
  - libffi=3.4.4
  - zlib=1.3.1
  - libuuid=2.38.1

  # ── Pip-managed packages (see requirements-lock.txt) ───────────
  - pip:
    - -r requirements-lock.txt
